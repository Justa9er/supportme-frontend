<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>supportME! Customer Dashboard</title>
  <style>
    :root {
      --primary-color: #0021F7;
      --accent-color: #5EDC1F;
      --text-color: #1F2937;
      --background-color: #F4F6F8;
      --border-color: #0021F7;
      --secondary-border: #E6ECF2;
    }

    body {
      margin: 0;
      background: var(--background-color);
      font-family: 'Open Sans', sans-serif;
      color: var(--text-color);
      width: 1600px;
      height: 950px;
      overflow: hidden;
      box-sizing: border-box;
    }

    .dashboard {
      display: flex;
      height: 100%;
      border: 2px solid var(--border-color);
      box-sizing: border-box;
    }

    /* Sidebar */
    .sidebar {
      width: 185px;
      background: var(--background-color);
      border-right: 2px solid var(--secondary-border);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .logo-box {
      height: 125px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-bottom: 2px solid var(--secondary-border);
    }

    .menu { 
      flex: 1; 
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .menu-item {
      position: relative;
      margin: 12px 0;
      font-family: 'Open Sans', sans-serif;
      color: var(--primary-color);
      font-size: 14px;
      font-weight: bold;
      text-transform: uppercase;
      text-align: center;
      width: 100%;
      cursor: pointer;
    }

    .menu-item::after {
      content: '';
      display: inline-block;
      width: 7px; 
      height: 7px;
      background: #F50000;
      border-radius: 50%;
      margin-left: 4px;
      vertical-align: super;
    }

    .branding {
      height: 152px;
      border-top: 2px solid var(--secondary-border);
      font-size: 10px;
      padding: 6px;
      display: flex;
      flex-direction: column;
      text-align: center;
    }

    .logo-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 8px;
    }

    .branding img { height: 30px; width: 30px; }
    .bottom-content { display: flex; flex-direction: column; gap: 4px; }
    .branding .line { border-top: 1px solid #91959E; margin: 4px 0; }
    .branding .links { font-size: 8px; }

    /* Main Content */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 10px;
      gap: 10px;
      width: 1405px;
      box-sizing: border-box;
    }

    .header {
      background: var(--accent-color);
      border: 2px solid var(--border-color);
      height: 57px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Agency FB', sans-serif;
      font-size: 36px;
      color: var(--primary-color);
      font-weight: bold;
      text-transform: uppercase;
      position: relative;
    }

    .customer-number {
      position: absolute;
      right: 70px;
      top: 15px;
      font-family: 'Agency FB', sans-serif;
      font-size: 12px;
    }

    .plan-badge {
      position: absolute;
      right: 10px;
      top: 5px;
      width: 37px; 
      height: 47px;
    }

    .time-banner {
      height: 67px;
      background: var(--background-color);
      border: 2px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
      font-family: 'Agency FB', sans-serif;
      font-size: 16px;
      font-weight: bold;
    }

    .time-banner .right { 
      display: flex; 
      flex-direction: column; 
      align-items: flex-end; 
    }

    .time-banner .top { 
      display: flex; 
      align-items: center; 
      gap: 6px; 
      margin-bottom: 4px; 
    }

    .time-banner button {
      font-family: 'Agency FB', sans-serif;
      font-size: 16px;
      font-weight: bold;
      padding: 6px 14px;
      margin-left: 8px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: var(--primary-color);
      color: #fff;
      text-transform: uppercase;
    }

    .time-banner button:hover { background: #3157B8; }

    .alert {
      height: 37px;
      border: 2px solid var(--border-color);
      background: var(--background-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 10px;
      font-size: 14px;
    }

    .content { 
      flex: 1; 
      border: 2px solid var(--border-color); 
      background: #fff; 
      padding: 5px; 
      display: flex; 
      flex-direction: column; 
      gap: 10px;
      overflow-y: auto;
    }

    /* Ticket History */
    .ticket-history { 
      padding: 10px; 
      border-bottom: 2px solid var(--border-color); 
    }

    .ticket-history h3 {
      font-family: 'Agency FB', sans-serif;
      font-size: 24px;
      color: var(--primary-color);
      font-weight: bold;
      text-transform: uppercase;
      margin: 0 0 10px 0;
    }

    .button-group {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    .button-group button {
      font-family: 'Agency FB', sans-serif;
      font-size: 14px;
      font-weight: bold;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: var(--primary-color);
      color: #fff;
      text-transform: uppercase;
    }

    .button-group button:hover { background: #3157B8; }

    table { 
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 10px; 
    }

    th, td {
      border: 1px solid #91959E;
      padding: 8px;
      text-align: left;
      font-size: 13px;
    }

    th { 
      background: var(--background-color); 
      font-weight: bold;
      font-family: 'Agency FB', sans-serif;
      font-size: 14px;
      color: var(--primary-color);
      text-transform: uppercase;
    }

    .priority-icon { 
      width: 12px; 
      height: 12px; 
      border-radius: 50%; 
      display: inline-block; 
      margin-right: 6px; 
    }

    .critical { background: #F50000; }
    .moderate { background: #F5CC00; }
    .low { background: var(--accent-color); }

    /* Ticket Form */
    .ticket-form { 
      padding: 10px; 
      display: flex; 
      flex-direction: column; 
      gap: 8px; 
      border: 2px solid var(--border-color);
      background: #fff;
      margin-top: 10px;
    }

    .ticket-form h3 {
      font-family: 'Agency FB', sans-serif;
      font-size: 24px;
      color: var(--primary-color);
      font-weight: bold;
      text-transform: uppercase;
      margin: 0 0 10px 0;
    }

    .ticket-form label {
      font-family: 'Agency FB', sans-serif;
      font-size: 14px;
      color: var(--primary-color);
      font-weight: bold;
      text-transform: uppercase;
      display: block;
      margin-bottom: 4px;
    }

    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .form-col {
      flex: 1;
      border: 1px solid var(--secondary-border);
      padding: 6px;
      box-sizing: border-box;
    }

    .form-col.priority { flex: 1; }
    .form-col.subject { flex: 2; }

    .ticket-form select,
    .ticket-form input { 
      width: 100%;
      padding: 6px; 
      font-size: 14px;
      border: 1px solid var(--secondary-border);
      border-radius: 4px;
      background: var(--background-color);
      color: var(--text-color);
      box-sizing: border-box;
    }

    .ticket-form textarea {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      border: 1px solid var(--secondary-border);
      border-radius: 4px;
      background: var(--background-color);
      color: var(--text-color);
      min-height: 80px;
      resize: vertical;
      box-sizing: border-box;
    }

    .form-buttons {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-top: 1px solid var(--secondary-border);
      padding-top: 10px;
      margin-top: 10px;
    }

    .upload-info {
      font-size: 12px;
      color: var(--text-color);
    }

    .upload-info ul {
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .upload-info li {
      padding: 2px 0;
      color: var(--primary-color);
    }

    .ticket-form button {
      font-family: 'Agency FB', sans-serif;
      font-size: 14px;
      font-weight: bold;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: var(--primary-color);
      color: #fff;
      text-transform: uppercase;
      margin-left: 8px;
    }

    .ticket-form button:first-child {
      margin-left: 0;
    }

    .ticket-form button:hover { background: #3157B8; }

    /* Footer Banner */
    .footer-banner {
      width: calc(100% - 4px);
      height: 149px;
      border: 2px solid var(--border-color);
      box-sizing: border-box;
      overflow: hidden;
      position: relative;
      background: var(--accent-color);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .footer-banner img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .banner-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: var(--primary-color);
      font-family: 'Agency FB', sans-serif;
      font-weight: bold;
      font-size: 24px;
      text-transform: uppercase;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .banner-content a {
      color: var(--primary-color);
      text-decoration: none;
      border: 2px solid var(--primary-color);
      padding: 10px 20px;
      margin-top: 10px;
      display: inline-block;
      background: rgba(255,255,255,0.9);
      border-radius: 4px;
      transition: all 0.3s ease;
    }

    .banner-content a:hover {
      background: var(--primary-color);
      color: #fff;
    }
  </style>
</head>
<body>
<div class="dashboard">
  <div class="sidebar">
    <div>
    <div class="logo-box">
  <img src="https://ucekalsakfxczmaxfpkq.supabase.co/storage/v1/object/public/logos/supportme-logo.png" height="120" alt="supportME! Logo">
</div>
      <div class="menu">
        <div class="menu-item">Tickets</div>
        <div class="menu-item">Chat</div>
        <div class="menu-item">Upload</div>
        <div class="menu-item">Contact</div>
      </div>
    </div>
    <div class="branding">
     <div class="logo-container">
  <img src="https://ucekalsakfxczmaxfpkq.supabase.co/storage/v1/object/public/logos/ringzu-logo.png" alt="RingzU Logo">
</div>
      <div class="bottom-content">
        <hr class="line">
        <div>© 2025 RingzU Telecom Corp.</div>
        <div>supportME! is built on the 
          <a href="https://www.ringzu.com" target="_blank" style="color:var(--primary-color); text-decoration:none;">
          <strong>RingzU Telecom Imagination Platform™</strong></a>
        </div>
        <div class="links">
          <a href="https://www.getsupportme.com/privacy" target="_blank" style="color:var(--primary-color); text-decoration:none;">Privacy</a> | 
          <a href="https://www.getsupportme.com/tos" target="_blank" style="color:var(--primary-color); text-decoration:none;">TOS</a> | 
          <a href="https://www.getsupportme.com/refund-policy" target="_blank" style="color:var(--primary-color); text-decoration:none;">Billing</a>
        </div>
      </div>
    </div>
  </div>
  <div class="main">
    <div class="header">
      CUSTOMER SUPPORT DASHBOARD
      <div class="customer-number"></div>
      <img class="plan-badge" src="https://static.wixstatic.com/media/b1d15d_df2a3091785d4d8cab05baa7c900e9d0~mv2.png">
    </div>
    <div class="time-banner">
      <div>supportME! official server time: <span id="dateTime"></span></div>
      <div class="right">
        <div class="top">
          <img src="https://i.pravatar.cc/30" alt="avatar"> 
          Welcome Back, <span id="welcomeName">User</span>
        </div>
        <div>
          <button onclick="alert('Sign Out clicked')">LOG IN/OUT</button>
          <button onclick="window.open('https://www.getsupportme.com/billing','_blank')">UPGRADE PLAN</button>
        </div>
      </div>
    </div>
    <div class="alert">
      <span>
        <img src="https://static.wixstatic.com/media/b1d15d_5a3c1bbb89254a5eb12554172de8e247~mv2.png" 
             alt="alert icon" width="38" height="30" style="vertical-align: middle; margin-right: 9px;">
        supportME! updates in real time. Do not close this window during ongoing conversations.
      </span>
      <span style="cursor:pointer;" onclick="this.parentElement.style.display='none'">X</span>
    </div>
    <div class="content">
      <div class="ticket-history">
        <h3>Ticket History</h3>
        <div class="button-group">
          <button onclick="refreshTickets()">Refresh</button>
          <button onclick="closeSelectedTickets()">Close Selected</button>
          <button onclick="exportTickets()">Export</button>
        </div>
        <table>
          <thead>
            <tr>
              <th><input type="checkbox" onchange="toggleAllTickets(this)"></th>
              <th>ID</th>
              <th>Subject</th>
              <th>Status</th>
              <th>Priority</th>
              <th>Created</th>
              <th>Last Updated</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="checkbox" name="ticketSelect" value="1001"></td>
              <td>1001</td>
              <td>Locked out of Account</td>
              <td><span style="color:#F50000; font-weight:bold;">Open</span></td>
              <td><span class="priority-icon critical"></span>Critical</td>
              <td>01/05/2025</td>
              <td>01/06/2025</td>
            </tr>
            <tr>
              <td><input type="checkbox" name="ticketSelect" value="1002"></td>
              <td>1002</td>
              <td>Billing Issue</td>
              <td><span style="color:#5EDC1F; font-weight:bold;">Closed</span></td>
              <td><span class="priority-icon moderate"></span>Moderate</td>
              <td>12/22/2024</td>
              <td>12/23/2024</td>
            </tr>
            <tr>
              <td><input type="checkbox" name="ticketSelect" value="1003"></td>
              <td>1003</td>
              <td>Feedback on Feature</td>
              <td><span style="color:#F50000; font-weight:bold;">Open</span></td>
              <td><span class="priority-icon low"></span>Low</td>
              <td>12/20/2024</td>
              <td>01/02/2025</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="ticket-form">
        <h3>Submit New Ticket</h3>
        
        <div class="form-row">
          <div class="form-col priority">
            <label>Priority Level</label>
            <select id="prioritySelect">
              <optgroup label="Critical (Red)">
                <option>Locked out of Account</option>
                <option>Account Takeover</option>
                <option>Fraud</option>
              </optgroup>
              <optgroup label="Moderate (Yellow)">
                <option>Billing</option>
                <option>Service Down</option>
                <option>Feature Broken</option>
              </optgroup>
              <optgroup label="Low (Green)">
                <option>General Question</option>
                <option>How-To</option>
                <option>Feedback</option>
              </optgroup>
            </select>
          </div>
          <div class="form-col subject">
            <label>Ticket Subject</label>
            <input type="text" id="subjectInput" placeholder="Enter ticket subject" maxlength="100">
          </div>
        </div>

        <div style="margin-bottom:10px; border:1px solid var(--secondary-border); padding:6px; box-sizing:border-box;">
          <label>Ticket Description</label>
          <textarea id="descriptionInput" placeholder="Describe your issue in detail" maxlength="500"></textarea>
        </div>

        <div class="form-buttons">
          <div class="upload-info">
            <ul id="uploadedFiles"></ul>
          </div>
          <div class="button-group">
            <button onclick="submitTicket()">Submit Ticket</button>
            <button onclick="subAddFile()">Add File</button>
            <button onclick="clearForm()">Clear Form</button>
          </div>
        </div>
      </div>
    </div>
    
   <div class="footer-banner">
  <img src="https://ucekalsakfxczmaxfpkq.supabase.co/storage/v1/object/public/banners/footer-banner.png" alt="supportME! Banner">
</div>

  </div>
</div>

<script>
// Server time clock
(function startServerClock(){
  const tz = "America/Los_Angeles";
  function updateServerTime(){
    const now = new Date();
    const dow = now.toLocaleDateString("en-US", {weekday:"long", timeZone:tz});
    const mm = String(now.getMonth()+1).padStart(2,"0");
    const dd = String(now.getDate()).padStart(2,"0");
    const yyyy = now.getFullYear();
    const hh = String(now.getHours()).padStart(2,"0");
    const mi = String(now.getMinutes()).padStart(2,"0");
    const ss = String(now.getSeconds()).padStart(2,"0");
    document.getElementById("dateTime").textContent = 
      `${dow} ${mm}/${dd}/${yyyy} ${hh}:${mi}:${ss} PT`;
  }
  updateServerTime();
  setInterval(updateServerTime, 1000);
})();

// Ticket management functions
function toggleAllTickets(masterCheckbox) {
  const checkboxes = document.querySelectorAll('input[name="ticketSelect"]');
  checkboxes.forEach(cb => cb.checked = masterCheckbox.checked);
}

function closeSelectedTickets() {
  const selected = document.querySelectorAll('input[name="ticketSelect"]:checked');
  if (selected.length > 0) {
    if (confirm(`Are you sure you want to close ${selected.length} selected ticket(s)?`)) {
      alert(`Closing ${selected.length} selected ticket(s)`);
      // Here you would make API calls to close the tickets
    }
  } else {
    alert("Please select tickets to close");
  }
}

function refreshTickets() {
  alert("Refreshing ticket list...");
  // Here you would reload the ticket data from your backend
}

function exportTickets() {
  alert("Exporting tickets to CSV...");
  // Here you would generate and download a CSV file
}

function submitTicket() {
  const priority = document.getElementById("prioritySelect").value;
  const subject = document.getElementById("subjectInput").value;
  const description = document.getElementById("descriptionInput").value;
  
  if (!subject.trim()) {
    alert("Please enter a ticket subject");
    return;
  }
  
  if (!description.trim()) {
    alert("Please enter a ticket description");
    return;
  }
  
  alert("Ticket submitted successfully!");
  clearForm();
}

function clearForm() {
  document.getElementById("prioritySelect").selectedIndex = 0;
  document.getElementById("subjectInput").value = "";
  document.getElementById("descriptionInput").value = "";
  document.getElementById("uploadedFiles").innerHTML = "";
}

function subAddFile() {
  // Create a hidden file input
  const input = document.createElement("input");
  input.type = "file";
  input.accept = ".pdf,.doc,.docx,.jpg,.jpeg,.png,.txt";
  input.multiple = true;

  input.onchange = async (e) => {
    const files = Array.from(e.target.files);
    if (!files.length) return;

    // File size limit (5 MB for basic plan, 10MB for pro, 20MB for enterprise)
    const planLimits = {
      'basic': 5 * 1024 * 1024,    // 5MB
      'pro': 10 * 1024 * 1024,     // 10MB
      'enterprise': 20 * 1024 * 1024 // 20MB
    };
    
    // This would normally come from user's plan data
    const userPlan = 'basic'; // Default to basic
    const limit = planLimits[userPlan];

    for (const file of files) {
      if (file.size > limit) {
        alert(`File "${file.name}" is too large. Maximum size for ${userPlan} plan is ${limit / (1024 * 1024)}MB.`);
        continue;
      }

      try {
        // Simulate file upload to Supabase
        // In real implementation, you would use:
        // const { data, error } = await supabase.storage
        //   .from("attachments")
        //   .upload(`user-files/${Date.now()}-${file.name}`, file);

        // For demo purposes, just show the file was "uploaded"
        await new Promise(resolve => setTimeout(resolve, 1000)); // Simulate upload delay
        
        // Show uploaded file name + size
        const fileList = document.getElementById("uploadedFiles");
        const li = document.createElement("li");
        li.textContent = `✓ ${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
        fileList.appendChild(li);
        
      } catch (error) {
        console.error("Upload failed:", error);
        alert(`Upload failed for "${file.name}": ${error.message}`);
      }
    }
  };

  input.click();
}

// Character count for textarea
document.getElementById("descriptionInput").addEventListener("input", function(e) {
  const remaining = 500 - e.target.value.length;
  const label = e.target.parentElement.querySelector("label");
  if (remaining < 50) {
    label.textContent = `Ticket Description (${remaining} characters remaining)`;
  } else {
    label.textContent = "Ticket Description";
  }
});

// Character count for subject
document.getElementById("subjectInput").addEventListener("input", function(e) {
  const remaining = 100 - e.target.value.length;
  const label = e.target.parentElement.querySelector("label");
  if (remaining < 20) {
    label.textContent = `Ticket Subject (${remaining} characters remaining)`;
  } else {
    label.textContent = "Ticket Subject";
  }
});
</script>
<script>
  async function updateHeader() {
    try {
      const tenantId = "YOUR_TENANT_ID"; // replace with actual
      const response = await fetch(`https://supportme-api.onrender.com/tenant-info/${tenantId}`);
      const data = await response.json();

      if (data.error) throw new Error(data.error);

      // Avatar
      const avatarUrl = data.avatar_url || "https://static.wixstatic.com/media/default-avatar.png";
      document.getElementById("avatarImg").src = avatarUrl;

      // Welcome text
      const siteName = data.site_name || "";
      document.getElementById("welcomeName").innerText = siteName || "User";
    } catch (err) {
      console.error("Header update failed:", err);
    }
  }

  updateHeader();
</script>

</body>
</html>
